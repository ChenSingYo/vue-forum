{"version":3,"sources":["webpack:///./src/views/UserEdit.vue","webpack:///./src/views/UserEdit.vue?d47a"],"names":["class","for","type","handleSubmit","name","id","placeholder","required","image","src","width","alt","handleFileChange","accept","data","email","isProcessing","computed","watch","currentUser","user","this","$route","params","setUser","created","beforeRouteUpdate","to","from","next","methods","userId","toString","$router","push","e","files","target","length","imageURL","window","URL","createObjectURL","fire","icon","title","form","formData","FormData","users","update","status","Error","message","console","log","render"],"mappings":"oJACOA,MAAM,kB,GAEFA,MAAM,c,EACT,eAA8B,SAAvBC,IAAI,QAAO,QAAI,G,GAYnBD,MAAM,c,EACT,eAA2B,SAApBC,IAAI,SAAO,S,EAiBpB,eAES,UAFDC,KAAK,SAASF,MAAM,mBAAkB,YAE9C,G,gDAnCJ,eAqCM,MArCN,EAqCM,CApCJ,eAmCO,QAnCA,SAAM,8CAAe,EAAAG,cAAA,EAAAA,aAAA,qBAAY,sB,CACtC,eAWM,MAXN,EAWM,CAVJ,E,eACA,eAQE,S,qDAPS,EAAAC,KAAI,IACbC,GAAG,OACHH,KAAK,OACLE,KAAK,OACLJ,MAAM,eACNM,YAAY,aACZC,SAAA,I,mBANS,EAAAH,UAUb,eAgBM,MAhBN,EAgBM,CAfJ,EAEQ,EAAAI,O,iBADR,eAKE,O,MAHCC,IAAK,EAAAD,MACNE,MAAM,MACNC,IAAI,e,uCAEN,eAOE,SANC,SAAM,8BAAE,EAAAC,kBAAA,EAAAA,iBAAA,qBACTP,GAAG,QACHH,KAAK,OACLE,KAAK,QACLS,OAAO,UACPb,MAAM,qB,WAIV,G,oIAYS,GACbc,KADa,WAEX,MAAO,CACLT,GAAI,EACJG,MAAO,GACPJ,KAAM,GACNW,MAAO,GACPC,cAAc,IAGlBC,SAAU,kBACL,eAAS,CAAC,iBAIfC,MAAO,CACLC,YADK,SACQC,GACX,IAAiB,IAAbA,EAAKf,GAAT,CADiB,IAETA,EAAOgB,KAAKC,OAAOC,OAAnBlB,GACRgB,KAAKG,QAAQnB,MAGjBoB,QAtBa,WAsBF,IACDpB,EAAOgB,KAAKC,OAAOC,OAAnBlB,GACRgB,KAAKG,QAAQnB,IAEfqB,kBA1Ba,SA0BMC,EAAIC,EAAMC,GAC3B,IAA6B,IAAzBR,KAAKF,YAAYd,GAArB,CADiC,IAEzBA,EAAOsB,EAAGJ,OAAVlB,GACRgB,KAAKG,QAAQnB,GACbwB,MAEFC,QAAS,CACPN,QADO,SACEO,GAAQ,MACoBV,KAAKF,YAAhCd,EADO,EACPA,GAAIG,EADG,EACHA,MAAOJ,EADJ,EACIA,KAAMW,EADV,EACUA,MAIrBV,EAAG2B,aAAeD,EAAOC,YAK7BX,KAAKhB,GAAKA,EACVgB,KAAKjB,KAAOA,EACZiB,KAAKN,MAAQA,EACbM,KAAKb,MAAQA,GAPXa,KAAKY,QAAQC,KAAK,CAAE9B,KAAM,eAS9BQ,iBAhBO,SAgBWuB,GAChB,IAAMC,EAAQD,EAAEE,OAAOD,MACvB,GAAKA,EAAME,OAAX,CACA,IAAMC,EAAWC,OAAOC,IAAIC,gBAAgBN,EAAM,IAClDf,KAAKb,MAAQ+B,IAETpC,aAtBC,SAsBagC,GAAG,gLAEd,EAAK/B,KAFS,uBAGjB,OAAMuC,KAAK,CACTC,KAAM,UACNC,MAAO,YALQ,iCAUbC,EAAOX,EAAEE,OACTU,EAAW,IAAIC,SAASF,GAE9B,EAAK9B,cAAe,EAbD,SAgBIiC,EAAA,KAASC,OAAO,CACrCnB,OAAQ,EAAK1B,GACb0C,aAlBiB,mBAgBXjC,EAhBW,EAgBXA,KAKY,UAAhBA,EAAKqC,OArBU,uBAsBX,IAAIC,MAAMtC,EAAKuC,SAtBJ,QAyBnB,EAAKpB,QAAQC,KAAK,CAAE9B,KAAM,OAAQmB,OAAQ,CAAElB,GAAI,EAAKA,MAzBlC,qDA2BnBiD,QAAQC,IAAR,MA3BmB,+DCjG3B,EAAOC,OAASA,EAED","file":"js/chunk-2d228901.71e58251.js","sourcesContent":["<template>\n  <div class=\"container py-5\">\n    <form @submit.stop.prevent=\"handleSubmit\">\n      <div class=\"form-group\">\n        <label for=\"name\">Name</label>\n        <input\n          v-model=\"name\"\n          id=\"name\"\n          type=\"text\"\n          name=\"name\"\n          class=\"form-control\"\n          placeholder=\"Enter Name\"\n          required\n        />\n      </div>\n\n      <div class=\"form-group\">\n        <label for=\"image\"></label>\n        <img\n          v-if=\"image\"\n          :src=\"image\"\n          width=\"200\"\n          alt=\"empty image\"\n        />\n        <input\n          @change=\"handleFileChange\"\n          id=\"image\"\n          type=\"file\"\n          name=\"image\"\n          accept=\"image/*\"\n          class=\"form-control-file\"\n        />\n      </div>\n\n      <button type=\"submit\" class=\"btn btn-primary\">\n        Submit\n      </button>\n    </form>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport usersAPI from './../apis/users'\nimport { Toast } from './../utils/helpers'\n\nexport default {\n  data () {\n    return {\n      id: 0,\n      image: '',\n      name: '',\n      email: '',\n      isProcessing: false\n    }\n  },\n  computed: {\n    ...mapState(['currentUser'])\n  },\n  // 由於 currentUser 是透過非同步的方式取得，需要透過 watch 屬性來監控當 currentUser 有變更後，\n  // 需要在呼叫一次 setUser 的方法把資料帶入該 Vue 組件內。\n  watch: {\n    currentUser (user) {\n      if (user.id === -1) return\n      const { id } = this.$route.params\n      this.setUser(id)\n    }\n  },\n  created () {\n    const { id } = this.$route.params\n    this.setUser(id)\n  },\n  beforeRouteUpdate (to, from, next) {\n    if (this.currentUser.id === -1) return\n    const { id } = to.params\n    this.setUser(id)\n    next()\n  },\n  methods: {\n    setUser (userId) {\n      const { id, image, name, email } = this.currentUser\n\n      // 在 setUser 中判斷該 currentUser 的 id 是否與路由中取得的 userId 相同，\n      // 如果不是的話，則轉址去 404，否則繼續執行 setUser\n      if (id.toString() !== userId.toString()) {\n        this.$router.push({ name: 'not-found' })\n        return\n      }\n\n      this.id = id\n      this.name = name\n      this.email = email\n      this.image = image\n    },\n    handleFileChange (e) {\n      const files = e.target.files\n      if (!files.length) return\n      const imageURL = window.URL.createObjectURL(files[0])\n      this.image = imageURL\n    },\n    async handleSubmit (e) {\n      try {\n        if (!this.name) {\n          Toast.fire({\n            icon: 'warning',\n            title: '您尚未填寫姓名'\n          })\n          return\n        }\n        // 從表單取得資料\n        const form = e.target\n        const formData = new FormData(form)\n\n        this.isProcessing = true\n\n        // 在 handleSubmit 中呼叫 usersAPI.update() 方法以更新使用者資料\n        const { data } = await usersAPI.update({\n          userId: this.id,\n          formData\n        })\n\n        if (data.status === 'error') {\n          throw new Error(data.message)\n        }\n        // 成功更新資料後轉址到使用者詳細頁\n        this.$router.push({ name: 'user', params: { id: this.id } })\n      } catch (e) {\n        console.log(e)\n      }\n    }\n  }\n}\n</script>\n","import { render } from \"./UserEdit.vue?vue&type=template&id=7c2f0ad0\"\nimport script from \"./UserEdit.vue?vue&type=script&lang=js\"\nexport * from \"./UserEdit.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}